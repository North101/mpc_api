"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function B(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var S={exports:{}},W=S.exports,R;function Y(){return R||(R=1,function(e,r){(function(t,a){e.exports=a()})(W,function(){var t=function(s,o){if(o=o||{},typeof s!="function")throw new n("fetch must be a function");if(typeof o!="object")throw new n("defaults must be an object");if(o.retries!==void 0&&!a(o.retries))throw new n("retries must be a positive integer");if(o.retryDelay!==void 0&&!a(o.retryDelay)&&typeof o.retryDelay!="function")throw new n("retryDelay must be a positive integer or a function returning a positive integer");if(o.retryOn!==void 0&&!Array.isArray(o.retryOn)&&typeof o.retryOn!="function")throw new n("retryOn property expects an array or function");var c={retries:3,retryDelay:1e3,retryOn:[]};return o=Object.assign(c,o),function(u,d){var b=o.retries,x=o.retryDelay,_=o.retryOn;if(d&&d.retries!==void 0)if(a(d.retries))b=d.retries;else throw new n("retries must be a positive integer");if(d&&d.retryDelay!==void 0)if(a(d.retryDelay)||typeof d.retryDelay=="function")x=d.retryDelay;else throw new n("retryDelay must be a positive integer or a function returning a positive integer");if(d&&d.retryOn)if(Array.isArray(d.retryOn)||typeof d.retryOn=="function")_=d.retryOn;else throw new n("retryOn property expects an array or function");return new Promise(function(v,w){var N=function(y){var O=typeof Request<"u"&&u instanceof Request?u.clone():u;s(O,d).then(function(l){if(Array.isArray(_)&&_.indexOf(l.status)===-1)v(l);else if(typeof _=="function")try{return Promise.resolve(_(y,null,l)).then(function(f){f?g(y,null,l):v(l)}).catch(w)}catch(f){w(f)}else y<b?g(y,null,l):v(l)}).catch(function(l){if(typeof _=="function")try{Promise.resolve(_(y,l,null)).then(function(f){f?g(y,l,null):w(l)}).catch(function(f){w(f)})}catch(f){w(f)}else y<b?g(y,l,null):w(l)})};function g(y,O,l){var f=typeof x=="function"?x(y,O,l):x;setTimeout(function(){N(++y)},f)}N(0)})}};function a(s){return Number.isInteger(s)&&s>=0}function n(s){this.name="ArgumentError",this.message=s}return t})}(S)),S.exports}var G=Y();const X=B(G),i=X(window.fetch),m=(e,r)=>r?`${e}?${new URLSearchParams(r)}`:e,q=e=>new DOMParser().parseFromString(e,"text/xml"),h=e=>new DOMParser().parseFromString(e,"text/html"),P=(e,r)=>document.evaluate(r,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;function*$(e,r){const t=document.evaluate(r,e,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var a=0;a<t.snapshotLength;a++){const n=t.snapshotItem(a);n&&(yield n)}}const D=e=>{const r={};for(const t of $(e,'//form[@id="form1"]/div[@class="aspNetHidden"]/input[@type="hidden"]')){const a=t;r[a.name]=a.value}for(const t of $(e,'//form[@id="form1"]/input[@type="hidden"]')){const a=t;r[a.name]=a.value}return r},A=async(e,r)=>{const t=await i(m(`${e.url}/products/pro_item_process_flow.aspx`,{itemid:e.unit,attachno:e.cardStock,pcs:`${r.length}`,producteffectno:e.printType,processno:e.finish,packid:e.packaging,qty:"1"}),{retries:5,retryDelay:500}),a=h(await t.text());return P(a,'/html/body/form[@id="form1"]/@action').textContent.replace("./dn_playingcards_front_dynamic.aspx?ssid=","")},F=async(e,r,t)=>{const a=t.length,n=m(`${r.url}/products/playingcard/design/dn_playingcards_mode_nf.aspx`,{ssid:e}),s=await i(n),o={...D(h(await s.text())),__EVENTTARGET:"btn_next_step",hidd_mode:"ImageText",txt_card_number:`${a}`,dro_total_count:`${a}`,hidd_material_no:r.cardStock,hidd_packing_no:r.packaging,hidd_design_count:`${a}`},c=new FormData;for(const[p,u]of Object.entries(o))c.append(p,u);return i(n,{method:"POST",body:c,retries:5,retryDelay:500})},I=async(e,r,t)=>{const a=t.length,n=m(`${r.url}/products/playingcard/design/dn_playingcards_mode_nb.aspx`,{ssid:e}),s=await i(n),o={...D(h(await s.text())),__EVENTTARGET:"btn_next_step",hidd_mode:"ImageText",hidd_design_count:`${a}`},c=new FormData;for(const[p,u]of Object.entries(o))c.append(p,u);return i(n,{method:"POST",body:c,retries:5,retryDelay:500})},C=async(e,r)=>{const t=m(`${r.url}/products/playingcard/design/dn_playingcards_front_dynamic.aspx`,{ssid:e}),a=await i(t),n={...D(h(await a.text())),__EVENTTARGET:"btn_next_step"},s=new FormData;for(const[c,p]of Object.entries(n))s.append(c,p);await i(t,{method:"POST",body:s,retries:5,retryDelay:500});const o=JSON.parse(n.hdParameter);return{pixelInfo:JSON.parse(o.Base.PixelInfo),unpickInfo:JSON.parse(o.Base.UnpickInfo)[0]}},j=async(e,r)=>{const t=m(`${r.url}/design/dn_texteditor_front.aspx`,{ssid:e}),a=await i(t),n={...D(h(await a.text())),__EVENTTARGET:"btn_next_step"},s=new FormData;for(const[o,c]of Object.entries(n))s.append(o,c);await i(t,{method:"POST",body:s,retries:5,retryDelay:500})},k=async(e,r)=>{const t=m(`${r.url}/products/playingcard/design/dn_playingcards_back_dynamic.aspx`,{ssid:e}),a=await i(t),n={...D(h(await a.text())),__EVENTTARGET:"btn_next_step"},s=new FormData;for(const[o,c]of Object.entries(n))s.append(o,c);await i(t,{method:"POST",body:s,retries:5,retryDelay:500})},H=async(e,r)=>{const t=m(`${r.url}/design/dn_texteditor_back.aspx`,{ssid:e}),a=await i(t),n={...D(h(await a.text())),__EVENTTARGET:"btn_next_step"},s=new FormData;for(const[o,c]of Object.entries(n))s.append(o,c);await i(t,{method:"POST",body:s,retries:5,retryDelay:500})},T=(e,r)=>({ID:r.SourceID,Exp:r.Exp,Owner:"",Path:`${e.url}/PreviewFiles/Normal/temp`,Width:r.Width,Height:r.Height,imageName:`${r.SourceID}.${r.Exp}`}),E=(e,r,t)=>[{ID:e.ID,SourceID:e.SourceID,Exp:e.Exp,X:t.X,Y:t.Y,Width:t.Width,Height:t.Height,CropX:0,CropY:0,CropWidth:t.Width,CropHeight:t.Height,CropRotate:0,Rotate:t.Rotate,Zoom:0,Scale:1,FlipHorizontal:"N",FlipVertical:"N",Sharpen:"N",Filter:r.Filter,Brightness:0,ThumbnailScale:1,AllowEdit:t.AllowEdit,AllowMove:t.AllowMove,Alpha:t.Alpha,Resolution:t.Resolution,Index:0,Quality:e.Height/t.Height*100>=t.Resolution?"Y":"N",AutoDirection:t.AutoDirection,ApplyMask:t.ApplyMask,IsEmpty:!1}],M=async(e,r,t,a,n)=>{const s=new FormData;return s.append("frontImageList",JSON.stringify(t.map(o=>o.front?T(r,o.front):null))),s.append("frontCropInfo",JSON.stringify(t.map(o=>o.front?E(o.front,a,n):null))),s.append("frontDesignModePage","dn_playingcards_mode_nf.aspx"),s.append("frontTextInfo",[...new Array(t.length)].map(()=>"").join("%u25C7")),s.append("backImageList",JSON.stringify(t.map(o=>o.back?T(r,o.back):null))),s.append("backCropInfo",JSON.stringify(t.map(o=>o.back?E(o.back,a,n):null))),s.append("backTextInfo",[...new Array(t.length)].map(()=>"").join("%u25C7")),s.append("backDesignModePage","dn_playingcards_mode_nb.aspx"),s.append("expand","null"),s.append("mapinfo","[]"),i(m(`${r.url}/design/dn_keep_transition_data.aspx`,{ssid:e}),{method:"POST",body:s,retries:5,retryDelay:500})},J=async(e,r)=>{if(!r.name)return;const t=new FormData;return t.append("name",r.name),i(m(`${r.url}/design/dn_project_save.aspx`,{ssid:e}),{method:"POST",body:t,retries:5,retryDelay:500})},V=async(e,r)=>{const t=r.reduce((o,c)=>{for(let p=0;p<c.count;p++)o.push(c);return o},[]),a=await A(e,t);await F(a,e,t),await I(a,e,t);const{pixelInfo:n,unpickInfo:s}=await C(a,e);return await j(a,e),await k(a,e),await H(a,e),await M(a,e,t,n,s),await J(a,e),`${e.url}/design/dn_preview_layout.aspx?ssid=${a}`},L=async(e,r)=>{const t=[],a=e.maxCards;let n=0,s=0;for(;n<r.length;){const o=[];let c=0;for(;c<a&&n<r.length;){const p=r[n],u=Math.min(p.count-s,a-c);o.push(u==p.count?p:{...p,count:u}),s+=u,s>=p.count&&(n+=1,s=0),c+=u}t.push(await V(e,o))}return t},U=async e=>await(await i(`${e}/api/common/getdatetime.ashx`)).text().then(t=>t.replace(/\-/g,"/")),z=async(e,r,t)=>{const a=await U(e.url),n=new FormData;n.append("fileData",t),n.append("userName",""),n.append("layer",r),n.append("st",a),n.append("pt","0"),n.append("ip","");const s=await i(`${e.url}/uploader/up_product.aspx`,{method:"POST",body:n,retries:5,retryDelay:500}),o=h(await s.text());return JSON.parse(P(o,'/html/body/form/input[@id="hidd_image_info"]/@value').textContent)},Q=async(e,r,t,a)=>{const n=new FormData;n.append("photoindex",`${t}`),n.append("source",JSON.stringify(a)),n.append("face",r),n.append("width",`${e.width}`),n.append("height",`${e.height}`),n.append("dpi",`${e.dpi}`),n.append("auto",e.auto?"Y":"N"),n.append("scale",`${e.scale}`),n.append("filter",""),n.append("productCode",e.product),n.append("designCode",r==="front"?e.frontDesign:e.backDesign),n.append("sortNo",`${e.sortNo}`),n.append("applyMask",e.applyMask?"Y":"N");const s=await i(`${e.url}/design/dn_product_analysis_photo.aspx`,{method:"POST",body:n,retries:5,retryDelay:500}),o=q(await s.text());return JSON.parse(P(o,"/Values/Value/text()").textContent).CropInfo},Z=(e,r)=>({ID:e.ID,SourceID:e.SourceID,Exp:r.Exp,Width:r.Width,Height:r.Height});exports.analysisImage=Q;exports.compressImageData=Z;exports.createAutoSplitProject=L;exports.createProject=V;exports.initProject=A;exports.saveBackImageStep=k;exports.saveBackSettings=I;exports.saveBackTextStep=H;exports.saveFrontImageStep=C;exports.saveFrontSettings=F;exports.saveFrontTextStep=j;exports.saveProject=J;exports.saveSession=M;exports.uncompressCropData=E;exports.uncompressImageData=T;exports.uploadImage=z;
