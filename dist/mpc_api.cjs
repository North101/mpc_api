"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function B(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $={exports:{}};(function(e,r){(function(t,a){e.exports=a()})(V,function(){var t=function(s,o){if(o=o||{},typeof s!="function")throw new n("fetch must be a function");if(typeof o!="object")throw new n("defaults must be an object");if(o.retries!==void 0&&!a(o.retries))throw new n("retries must be a positive integer");if(o.retryDelay!==void 0&&!a(o.retryDelay)&&typeof o.retryDelay!="function")throw new n("retryDelay must be a positive integer or a function returning a positive integer");if(o.retryOn!==void 0&&!Array.isArray(o.retryOn)&&typeof o.retryOn!="function")throw new n("retryOn property expects an array or function");var i={retries:3,retryDelay:1e3,retryOn:[]};return o=Object.assign(i,o),function(u,d){var b=o.retries,D=o.retryDelay,_=o.retryOn;if(d&&d.retries!==void 0)if(a(d.retries))b=d.retries;else throw new n("retries must be a positive integer");if(d&&d.retryDelay!==void 0)if(a(d.retryDelay)||typeof d.retryDelay=="function")D=d.retryDelay;else throw new n("retryDelay must be a positive integer or a function returning a positive integer");if(d&&d.retryOn)if(Array.isArray(d.retryOn)||typeof d.retryOn=="function")_=d.retryOn;else throw new n("retryOn property expects an array or function");return new Promise(function(S,w){var P=function(y){var v=typeof Request<"u"&&u instanceof Request?u.clone():u;s(v,d).then(function(l){if(Array.isArray(_)&&_.indexOf(l.status)===-1)S(l);else if(typeof _=="function")try{return Promise.resolve(_(y,null,l)).then(function(f){f?x(y,null,l):S(l)}).catch(w)}catch(f){w(f)}else y<b?x(y,null,l):S(l)}).catch(function(l){if(typeof _=="function")try{Promise.resolve(_(y,l,null)).then(function(f){f?x(y,l,null):w(l)}).catch(function(f){w(f)})}catch(f){w(f)}else y<b?x(y,l,null):w(l)})};function x(y,v,l){var f=typeof D=="function"?D(y,v,l):D;setTimeout(function(){P(++y)},f)}P(0)})}};function a(s){return Number.isInteger(s)&&s>=0}function n(s){this.name="ArgumentError",this.message=s}return t})})($);var W=$.exports;const Y=B(W),c=Y(window.fetch),m=(e,r)=>r?`${e}?${new URLSearchParams(r)}`:e,G=e=>new DOMParser().parseFromString(e,"text/xml"),h=e=>new DOMParser().parseFromString(e,"text/html"),E=(e,r)=>document.evaluate(r,e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;function*N(e,r){const t=document.evaluate(r,e,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var a=0;a<t.snapshotLength;a++){const n=t.snapshotItem(a);n&&(yield n)}}const g=e=>{const r={};for(const t of N(e,'//form[@id="form1"]/div[@class="aspNetHidden"]/input[@type="hidden"]')){const a=t;r[a.name]=a.value}for(const t of N(e,'//form[@id="form1"]/input[@type="hidden"]')){const a=t;r[a.name]=a.value}return r},A=async(e,r)=>{const t=await c(m(`${e.url}/products/pro_item_process_flow.aspx`,{itemid:e.unit,attachno:e.cardStock,pcs:`${r.length}`,producteffectno:e.printType,processno:e.finish,packid:e.packaging,qty:"1"}),{retries:5,retryDelay:500}),a=h(await t.text());return E(a,'/html/body/form[@id="form1"]/@action').textContent.replace("./dn_playingcards_front_dynamic.aspx?ssid=","")},F=async(e,r,t)=>{const a=t.length,n=m(`${r.url}/products/playingcard/design/dn_playingcards_mode_nf.aspx`,{ssid:e}),s=await c(n),o={...g(h(await s.text())),__EVENTTARGET:"btn_next_step",hidd_mode:"ImageText",txt_card_number:`${a}`,dro_total_count:`${a}`,hidd_material_no:r.cardStock,hidd_packing_no:r.packaging,hidd_design_count:`${a}`},i=new FormData;for(const[p,u]of Object.entries(o))i.append(p,u);return c(n,{method:"POST",body:i,retries:5,retryDelay:500})},I=async(e,r,t)=>{const a=t.length,n=m(`${r.url}/products/playingcard/design/dn_playingcards_mode_nb.aspx`,{ssid:e}),s=await c(n),o={...g(h(await s.text())),__EVENTTARGET:"btn_next_step",hidd_mode:"ImageText",hidd_design_count:`${a}`},i=new FormData;for(const[p,u]of Object.entries(o))i.append(p,u);return c(n,{method:"POST",body:i,retries:5,retryDelay:500})},R=async(e,r)=>{const t=m(`${r.url}/products/playingcard/design/dn_playingcards_front_dynamic.aspx`,{ssid:e}),a=await c(t),n={...g(h(await a.text())),__EVENTTARGET:"btn_next_step"},s=new FormData;for(const[i,p]of Object.entries(n))s.append(i,p);await c(t,{method:"POST",body:s,retries:5,retryDelay:500});const o=JSON.parse(n.hdParameter);return{pixelInfo:JSON.parse(o.Base.PixelInfo),unpickInfo:JSON.parse(o.Base.UnpickInfo)[0]}},C=async(e,r)=>{const t=m(`${r.url}/design/dn_texteditor_front.aspx`,{ssid:e}),a=await c(t),n={...g(h(await a.text())),__EVENTTARGET:"btn_next_step"},s=new FormData;for(const[o,i]of Object.entries(n))s.append(o,i);await c(t,{method:"POST",body:s,retries:5,retryDelay:500})},j=async(e,r)=>{const t=m(`${r.url}/products/playingcard/design/dn_playingcards_back_dynamic.aspx`,{ssid:e}),a=await c(t),n={...g(h(await a.text())),__EVENTTARGET:"btn_next_step"},s=new FormData;for(const[o,i]of Object.entries(n))s.append(o,i);await c(t,{method:"POST",body:s,retries:5,retryDelay:500})},k=async(e,r)=>{const t=m(`${r.url}/design/dn_texteditor_back.aspx`,{ssid:e}),a=await c(t),n={...g(h(await a.text())),__EVENTTARGET:"btn_next_step"},s=new FormData;for(const[o,i]of Object.entries(n))s.append(o,i);await c(t,{method:"POST",body:s,retries:5,retryDelay:500})},O=(e,r)=>({ID:r.SourceID,Exp:r.Exp,Owner:"",Path:`${e.url}/PreviewFiles/Normal/temp`,Width:r.Width,Height:r.Height,imageName:`${r.SourceID}.${r.Exp}`}),T=(e,r,t)=>[{ID:e.ID,SourceID:e.SourceID,Exp:e.Exp,X:t.X,Y:t.Y,Width:t.Width,Height:t.Height,CropX:0,CropY:0,CropWidth:t.Width,CropHeight:t.Height,CropRotate:0,Rotate:t.Rotate,Zoom:0,Scale:1,FlipHorizontal:"N",FlipVertical:"N",Sharpen:"N",Filter:r.Filter,Brightness:0,ThumbnailScale:1,AllowEdit:t.AllowEdit,AllowMove:t.AllowMove,Alpha:t.Alpha,Resolution:t.Resolution,Index:0,Quality:e.Height/t.Height*100>=t.Resolution?"Y":"N",AutoDirection:t.AutoDirection,ApplyMask:t.ApplyMask,IsEmpty:!1}],H=async(e,r,t,a,n)=>{const s=new FormData;return s.append("frontImageList",JSON.stringify(t.map(o=>o.front?O(r,o.front):null))),s.append("frontCropInfo",JSON.stringify(t.map(o=>o.front?T(o.front,a,n):null))),s.append("frontDesignModePage","dn_playingcards_mode_nf.aspx"),s.append("frontTextInfo",[...new Array(t.length)].map(()=>"").join("%u25C7")),s.append("backImageList",JSON.stringify(t.map(o=>o.back?O(r,o.back):null))),s.append("backCropInfo",JSON.stringify(t.map(o=>o.back?T(o.back,a,n):null))),s.append("backTextInfo",[...new Array(t.length)].map(()=>"").join("%u25C7")),s.append("backDesignModePage","dn_playingcards_mode_nb.aspx"),s.append("expand","null"),s.append("mapinfo","[]"),c(m(`${r.url}/design/dn_keep_transition_data.aspx`,{ssid:e}),{method:"POST",body:s,retries:5,retryDelay:500})},M=async(e,r)=>{if(!r.name)return;const t=new FormData;return t.append("name",r.name),c(m(`${r.url}/design/dn_project_save.aspx`,{ssid:e}),{method:"POST",body:t,retries:5,retryDelay:500})},J=async(e,r)=>{const t=r.reduce((o,i)=>{for(let p=0;p<i.count;p++)o.push(i);return o},[]),a=await A(e,t);await F(a,e,t),await I(a,e,t);const{pixelInfo:n,unpickInfo:s}=await R(a,e);return await C(a,e),await j(a,e),await k(a,e),await H(a,e,t,n,s),await M(a,e),`${e.url}/design/dn_preview_layout.aspx?ssid=${a}`},X=async(e,r)=>{const t=[],a=e.maxCards;let n=0,s=0;for(;n<r.length;){const o=[];let i=0;for(;i<a&&n<r.length;){const p=r[n],u=Math.min(p.count-s,a-i);o.push(u==p.count?p:{...p,count:u}),s+=u,s>=p.count&&(n+=1,s=0),i+=u}t.push(await J(e,o))}return t},L=async e=>await(await c(`${e}/api/common/getdatetime.ashx`)).text().then(t=>t.replace(/\-/g,"/")),q=async(e,r,t)=>{const a=await L(e.url),n=new FormData;n.append("fileData",t),n.append("userName",""),n.append("layer",r),n.append("st",a),n.append("pt","0"),n.append("ip","");const s=await c(`${e.url}/uploader/up_product.aspx`,{method:"POST",body:n,retries:5,retryDelay:500}),o=h(await s.text());return JSON.parse(E(o,'/html/body/form/input[@id="hidd_image_info"]/@value').textContent)},U=async(e,r,t,a)=>{const n=new FormData;n.append("photoindex",`${t}`),n.append("source",JSON.stringify(a)),n.append("face",r),n.append("width",`${e.width}`),n.append("height",`${e.height}`),n.append("dpi",`${e.dpi}`),n.append("auto",e.auto?"Y":"N"),n.append("scale",`${e.scale}`),n.append("filter",""),n.append("productCode",e.product),n.append("designCode",r==="front"?e.frontDesign:e.backDesign),n.append("sortNo",`${e.sortNo}`),n.append("applyMask",e.applyMask?"Y":"N");const s=await c(`${e.url}/design/dn_product_analysis_photo.aspx`,{method:"POST",body:n,retries:5,retryDelay:500}),o=G(await s.text());return JSON.parse(E(o,"/Values/Value/text()").textContent).CropInfo},z=(e,r)=>({ID:e.ID,SourceID:e.SourceID,Exp:r.Exp,Width:r.Width,Height:r.Height});exports.analysisImage=U;exports.compressImageData=z;exports.createAutoSplitProject=X;exports.createProject=J;exports.initProject=A;exports.saveBackImageStep=j;exports.saveBackSettings=I;exports.saveBackTextStep=k;exports.saveFrontImageStep=R;exports.saveFrontSettings=F;exports.saveFrontTextStep=C;exports.saveProject=M;exports.saveSession=H;exports.uncompressCropData=T;exports.uncompressImageData=O;exports.uploadImage=q;
